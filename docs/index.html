<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>ä¸­æ–‡â†’é˜¿ç¾èª ç¿»è­¯ & è²éŸ³å…‹éš†</title>
  <style>
    body{font-family:sans-serif;background:#eef2f7;margin:0;display:flex;align-items:center;justify-content:center;height:100vh}
    .card{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);width:100%;max-width:480px;text-align:center}
    h1{color:#2c3e50;margin-bottom:1rem}
    p{color:#555;margin-bottom:1.5rem}
    input,button{margin:0.5rem 0}
    button{background:#3498db;color:#fff;border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;transition:0.3s}
    button:hover{background:#2980b9}
    #log,#db-log{background:#f7f9fa;padding:1rem;border-radius:6px;white-space:pre-wrap;text-align:left;min-height:3rem;overflow:auto}
    audio{margin-top:1rem;width:100%}
  </style>
</head>
<body>
  <div class="card">
    <h1>ä¸­æ–‡â†’é˜¿ç¾èª ç¿»è­¯ & è²éŸ³å…‹éš†</h1>
    <p>éŒ„è£½/ä¸Šå‚³ä¸­æ–‡ â†’ è¾¨è­˜ â†’ è³‡æ–™åº«æŸ¥ â†’ Gemini TTS</p>
    <input type="file" id="wav" accept="audio/*">
    <button id="run">ç¿»è­¯ & åˆæˆ</button>
    <div id="log"></div>
    <audio id="player" controls></audio>
    <hr>
    <h2>ğŸ”„ æ›´æ–°æ¯èªè³‡æ–™åº«</h2>
    <input type="file" id="dbfiles" accept="audio/*" multiple>
    <button id="upload-db">ä¸Šå‚³ä¸¦å»ºç«‹è³‡æ–™åº«</button>
    <div id="db-log"></div>
  </div>
<script>
const API = "https://<https://ai20529.onrender.com/api/process";
const UP = "https://<https://ai20529.onrender.com/api/upload-db";

document.getElementById('run').onclick = async ()=>{
  const f = document.getElementById('wav').files[0];if(!f){alert('è«‹é¸æ“‡éŸ³æª”');return;}
  const b=await f.arrayBuffer(),b64='data:audio/wav;base64,'+btoa(String.fromCharCode(...new Uint8Array(b)));
  document.getElementById('log').innerText='å‘¼å«ä¸­â€¦';
  try{const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({audio_b64:b64})});
    const j=await r.json();if(!r.ok)throw j;
    document.getElementById('log').innerText=
      `ä¸­æ–‡ï¼š${j.zh}\né˜¿ç¾èªï¼š${j.ame_text}\næ‹¼éŸ³ï¼š${j.ame_pinyin}\néŸ³èª¿ï¼š${j.ame_pitch}`;
    document.getElementById('player').src=j.voice_clone_b64;
  }catch(e){document.getElementById('log').innerText=e.error||'éŒ¯èª¤';}
};

document.getElementById('upload-db').onclick = async ()=>{
  const fs=document.getElementById('dbfiles').files; if(!fs.length){alert('é¸æª”');return;}
  const fd=new FormData();for(let f of fs)fd.append('files',f);
  document.getElementById('db-log').innerText='æ›´æ–°ä¸­â€¦';
  try{const r=await fetch(UP,{method:'POST',body:fd});const j=await r.json();if(!r.ok)throw j;
    document.getElementById('db-log').innerText=`æ–°å¢${j.added}ç­†:\n`+j.entries.map(e=>e.zh+'â†’'+e.ame_text).join('\n');
  }catch(e){document.getElementById('db-log').innerText=e.error||'å¤±æ•—';}
};
</script>
</body>
</html>
