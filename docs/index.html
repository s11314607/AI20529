<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>中文→阿美語 翻譯 & 聲音克隆</title>
  <style>
    body{font-family:sans-serif;background:#eef2f7;margin:0;display:flex;align-items:center;justify-content:center;height:100vh}
    .card{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);width:100%;max-width:480px;text-align:center}
    h1{color:#2c3e50;margin-bottom:1rem}
    p{color:#555;margin-bottom:1.5rem}
    input,button{margin:0.5rem 0}
    button{background:#3498db;color:#fff;border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;transition:0.3s}
    button:hover{background:#2980b9}
    #log,#db-log{background:#f7f9fa;padding:1rem;border-radius:6px;white-space:pre-wrap;text-align:left;min-height:3rem;overflow:auto}
    audio{margin-top:1rem;width:100%}
  </style>
</head>
<body>
  <div class="card">
    <h1>中文→阿美語 翻譯 & 聲音克隆</h1>
    <p>錄製/上傳中文 → 辨識 → 資料庫查 → Gemini TTS</p>
    <input type="file" id="wav" accept="audio/*">
    <button id="run">翻譯 & 合成</button>
    <div id="log"></div>
    <audio id="player" controls></audio>
    <hr>
    <h2>🔄 更新母語資料庫</h2>
    <input type="file" id="dbfiles" accept="audio/*" multiple>
    <button id="upload-db">上傳並建立資料庫</button>
    <div id="db-log"></div>
  </div>
<script>
const API = "https://<https://ai20529.onrender.com/api/process";
const UP = "https://<https://ai20529.onrender.com/api/upload-db";

document.getElementById('run').onclick = async ()=>{
  const f = document.getElementById('wav').files[0];if(!f){alert('請選擇音檔');return;}
  const b=await f.arrayBuffer(),b64='data:audio/wav;base64,'+btoa(String.fromCharCode(...new Uint8Array(b)));
  document.getElementById('log').innerText='呼叫中…';
  try{const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({audio_b64:b64})});
    const j=await r.json();if(!r.ok)throw j;
    document.getElementById('log').innerText=
      `中文：${j.zh}\n阿美語：${j.ame_text}\n拼音：${j.ame_pinyin}\n音調：${j.ame_pitch}`;
    document.getElementById('player').src=j.voice_clone_b64;
  }catch(e){document.getElementById('log').innerText=e.error||'錯誤';}
};

document.getElementById('upload-db').onclick = async ()=>{
  const fs=document.getElementById('dbfiles').files; if(!fs.length){alert('選檔');return;}
  const fd=new FormData();for(let f of fs)fd.append('files',f);
  document.getElementById('db-log').innerText='更新中…';
  try{const r=await fetch(UP,{method:'POST',body:fd});const j=await r.json();if(!r.ok)throw j;
    document.getElementById('db-log').innerText=`新增${j.added}筆:\n`+j.entries.map(e=>e.zh+'→'+e.ame_text).join('\n');
  }catch(e){document.getElementById('db-log').innerText=e.error||'失敗';}
};
</script>
</body>
</html>
